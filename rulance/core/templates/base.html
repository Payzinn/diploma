{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'core/style.css' %}">
    <title>{% block title %}{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="header__logo">Rulance</div>
        <nav class="header__nav">
            <a href="/" class="header__link {% if request.path == '/' %}active{% endif %}">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/orders/" class="header__link {% if request.path == '/orders/' %}active{% endif %}">–ó–∞–∫–∞–∑—ã</a>
            <a href="/freelancers/" class="header__link {% if request.path == '/freelancers/' %}active{% endif %}">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã</a>
        </nav>
        <div class="text-right">
            {% if user.is_authenticated %}
                <div class="dropdown">
                    
                    <div class="dropdown__toggle">
                        {% if user.is_authenticated %}
                        <a href="{% url 'notifications_list' %}" class="nav-notif">
                          üîî
                          {% if unread_count %}
                            <span class="nav-notif__badge">{{ unread_count }}</span>
                          {% endif %}
                        </a>
                      {% endif %}
                        <img src="{% if user.avatar %}{{ user.avatar.url }}{% else %}/static/default_avatar.png{% endif %}" 
                             class="dropdown__avatar">
                        <span>{{ user.username }}</span>
                    </div>
                    <div class="dropdown__content">
                        <a href="{% url 'switch_role' %}" class="dropdown__item">
                            –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ {% if user.role == 'Freelancer' %}–ó–∞–∫–∞–∑—á–∏–∫–∞{% else %}–§—Ä–∏–ª–∞–Ω—Å–µ—Ä–∞{% endif %}
                        </a>
                        <div class="dropdown__divider"></div>
                        <a href="{% url 'profile' %}" class="dropdown__item">–ü—Ä–æ—Ñ–∏–ª—å</a>
                        <form method="post" action="{% url 'logout' %}" class="dropdown__form">
                            {% csrf_token %}
                            <button type="submit" class="dropdown__logout">–í—ã–π—Ç–∏</button>
                        </form>
                    </div>
                </div>
            {% else %}
                <a href="{% url 'login' %}" class="header__link">–í–æ–π—Ç–∏</a>
                <a href="{% url 'register' %}" class="header__link">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}
        </div>
    </header>
    <div class="container">
        {% block content %}{% endblock %}
    </div>
    <div id="notification" class="notification"></div>

    <script>
        document.querySelectorAll('.dropdown').forEach(dropdown => {
            const toggle = dropdown.querySelector('.dropdown__toggle');
            const content = dropdown.querySelector('.dropdown__content');
            
            toggle.addEventListener('click', () => {
                content.classList.toggle('show');
            });
            
            document.addEventListener('click', (e) => {
                if (!dropdown.contains(e.target)) {
                    content.classList.remove('show');
                }
            });
        });
    </script>

{% include 'includes/confirm-modal.html' %}
{% include 'includes/modal-sphere.html' %}


<script src="{% static 'core/js/confirm.js' %}" defer></script>
<script src="{% static 'core/js/filter.js' %}" defer></script>
<script src="{% static 'core/js/make_order.js' %}" defer></script>
<script src="{% static 'core/js/notification.js' %}" defer></script>
<script src="{% static 'core/js/dropzone_form.js' %}" defer></script>
<script src="{% static 'core/js/profile.js' %}" defer></script>
<script src="{% static 'core/js/modal-spheres.js' %}" defer></script>
<script src="{% static 'core/js/toggles.js' %}" defer></script>
</body>
</html>